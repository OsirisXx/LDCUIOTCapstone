{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Harley\\\\Desktop\\\\Capstone\\\\attendanceiot\\\\IOTCapstone\\\\frontend\\\\src\\\\pages\\\\RFIDScanner.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport axios from 'axios';\nimport { toast } from 'react-hot-toast';\nimport { useAuth } from '../contexts/AuthContext';\nimport { CreditCardIcon, CheckCircleIcon, XCircleIcon, ClockIcon, UserIcon } from '@heroicons/react/24/outline';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction RFIDScanner() {\n  _s();\n  const {\n    user\n  } = useAuth();\n  const [isScanning, setIsScanning] = useState(false);\n  const [lastScan, setLastScan] = useState(null);\n  const [scanHistory, setScanHistory] = useState([]);\n  const inputRef = useRef(null);\n  const scanTimeoutRef = useRef(null);\n  const rfidBufferRef = useRef('');\n  useEffect(() => {\n    // Focus the hidden input when component mounts\n    if (inputRef.current) {\n      inputRef.current.focus();\n    }\n\n    // Refocus input when window regains focus\n    const handleFocus = () => {\n      if (inputRef.current) {\n        inputRef.current.focus();\n      }\n    };\n    window.addEventListener('focus', handleFocus);\n    document.addEventListener('click', handleFocus);\n    return () => {\n      window.removeEventListener('focus', handleFocus);\n      document.removeEventListener('click', handleFocus);\n      if (scanTimeoutRef.current) {\n        clearTimeout(scanTimeoutRef.current);\n      }\n    };\n  }, []);\n  const handleKeyPress = e => {\n    // RFID readers typically send data very quickly and end with Enter\n    if (e.key === 'Enter') {\n      if (rfidBufferRef.current.length > 4) {\n        processRFIDScan(rfidBufferRef.current.trim());\n      }\n      rfidBufferRef.current = '';\n      e.target.value = '';\n      return;\n    }\n\n    // Add character to buffer\n    rfidBufferRef.current += e.key;\n\n    // Clear previous timeout and set new one\n    if (scanTimeoutRef.current) {\n      clearTimeout(scanTimeoutRef.current);\n    }\n\n    // If no more input for 200ms, process the scan\n    scanTimeoutRef.current = setTimeout(() => {\n      if (rfidBufferRef.current.length > 4) {\n        processRFIDScan(rfidBufferRef.current.trim());\n      }\n      rfidBufferRef.current = '';\n      if (inputRef.current) {\n        inputRef.current.value = '';\n      }\n    }, 200);\n  };\n  const processRFIDScan = async rfidData => {\n    try {\n      // Check if user is authenticated\n      if (!user) {\n        toast.error('‚ùå Please login to use RFID scanner');\n        return;\n      }\n      setIsScanning(true);\n      console.log('RFID Card Detected:', rfidData);\n\n      // Get authentication token\n      const token = localStorage.getItem('token');\n      if (!token) {\n        throw new Error('No authentication token found');\n      }\n      const response = await axios.post('http://localhost:5000/api/logs/rfid-scan', {\n        rfid_data: rfidData,\n        location: 'inside',\n        timestamp: new Date().toISOString()\n      }, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      if (response.status === 201) {\n        const attendance = response.data.attendance;\n        const scanResult = {\n          id: Date.now(),\n          rfid: rfidData,\n          user: attendance.user,\n          status: attendance.status,\n          time: new Date().toLocaleTimeString('en-US', {\n            timeZone: 'Asia/Manila'\n          }),\n          success: true\n        };\n        setLastScan(scanResult);\n        setScanHistory(prev => [scanResult, ...prev.slice(0, 9)]); // Keep last 10 scans\n\n        // Check if user is instructor or admin for lock control\n        if (attendance.user.type === 'instructor' || attendance.user.type === 'admin') {\n          console.log('üîì Instructor/Admin detected - Triggering solenoid lock...');\n\n          // Trigger solenoid lock via ESP32\n          try {\n            await triggerSolenoidLock(attendance.user.name);\n            scanResult.lockTriggered = true;\n            toast.success(`‚úÖ ${attendance.user.name} - ${attendance.status} - üîì Lock Opened!`);\n          } catch (lockError) {\n            console.error('Lock trigger error:', lockError);\n            scanResult.lockTriggered = false;\n            scanResult.lockError = lockError.message;\n            toast.success(`‚úÖ ${attendance.user.name} - ${attendance.status} - ‚ö†Ô∏è Lock control failed`);\n          }\n        } else {\n          toast.success(`‚úÖ ${attendance.user.name} - ${attendance.status}`);\n        }\n      }\n    } catch (error) {\n      var _error$response, _error$response$data, _error$response2;\n      console.error('RFID scan error:', error);\n      const scanResult = {\n        id: Date.now(),\n        rfid: rfidData,\n        user: null,\n        status: 'Error',\n        time: new Date().toLocaleTimeString('en-US', {\n          timeZone: 'Asia/Manila'\n        }),\n        success: false,\n        error: ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || 'Unknown error'\n      };\n      setLastScan(scanResult);\n      setScanHistory(prev => [scanResult, ...prev.slice(0, 9)]);\n      if (((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.status) === 404) {\n        toast.error('‚ùå RFID card not registered');\n      } else {\n        toast.error('‚ùå Failed to record attendance');\n      }\n    } finally {\n      setIsScanning(false);\n    }\n  };\n  const getStatusIcon = (success, status) => {\n    if (!success) return /*#__PURE__*/_jsxDEV(XCircleIcon, {\n      className: \"h-5 w-5 text-red-500\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 26\n    }, this);\n    switch (status === null || status === void 0 ? void 0 : status.toLowerCase()) {\n      case 'present':\n        return /*#__PURE__*/_jsxDEV(CheckCircleIcon, {\n          className: \"h-5 w-5 text-green-500\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 16\n        }, this);\n      case 'late':\n        return /*#__PURE__*/_jsxDEV(ClockIcon, {\n          className: \"h-5 w-5 text-yellow-500\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 16\n        }, this);\n      default:\n        return /*#__PURE__*/_jsxDEV(CheckCircleIcon, {\n          className: \"h-5 w-5 text-blue-500\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 172,\n          columnNumber: 16\n        }, this);\n    }\n  };\n  const getStatusColor = (success, status) => {\n    if (!success) return 'bg-red-100 text-red-800';\n    switch (status === null || status === void 0 ? void 0 : status.toLowerCase()) {\n      case 'present':\n        return 'bg-green-100 text-green-800';\n      case 'late':\n        return 'bg-yellow-100 text-yellow-800';\n      default:\n        return 'bg-blue-100 text-blue-800';\n    }\n  };\n\n  // Function to trigger solenoid lock via ESP32\n  const triggerSolenoidLock = async userName => {\n    try {\n      // Get authentication token\n      const token = localStorage.getItem('token');\n      if (!token) {\n        throw new Error('No authentication token found');\n      }\n\n      // Send command to ESP32 to open lock\n      const response = await axios.post('http://localhost:5000/api/devices/trigger-lock', {\n        action: 'open',\n        user: userName,\n        timestamp: new Date().toISOString()\n      }, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        },\n        timeout: 15000 // 15 second timeout\n      });\n      if (response.status === 200) {\n        console.log('üîì Solenoid lock triggered successfully');\n        return true;\n      } else {\n        throw new Error('Failed to trigger lock');\n      }\n    } catch (error) {\n      var _error$response3, _error$response3$data;\n      console.error('Solenoid lock trigger error:', error);\n      throw new Error('Lock control failed: ' + (((_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : (_error$response3$data = _error$response3.data) === null || _error$response3$data === void 0 ? void 0 : _error$response3$data.message) || error.message));\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"space-y-6\",\n    children: [/*#__PURE__*/_jsxDEV(\"input\", {\n      ref: inputRef,\n      type: \"text\",\n      onKeyPress: handleKeyPress,\n      style: {\n        position: 'absolute',\n        left: '-9999px',\n        opacity: 0,\n        pointerEvents: 'none'\n      },\n      autoFocus: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        className: \"text-2xl font-bold text-gray-900\",\n        children: \"RFID Scanner\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-gray-600\",\n        children: \"Scan RFID cards for attendance tracking\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"card\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center py-8\",\n        children: [!user ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mx-auto w-24 h-24 rounded-full flex items-center justify-center mb-4 bg-red-100\",\n          children: /*#__PURE__*/_jsxDEV(XCircleIcon, {\n            className: \"h-12 w-12 text-red-600\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 247,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `mx-auto w-24 h-24 rounded-full flex items-center justify-center mb-4 ${isScanning ? 'bg-blue-100 animate-pulse' : 'bg-gray-100'}`,\n          children: /*#__PURE__*/_jsxDEV(CreditCardIcon, {\n            className: `h-12 w-12 ${isScanning ? 'text-blue-600' : 'text-gray-400'}`\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 253,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 250,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n          className: \"text-lg font-medium text-gray-900 mb-2\",\n          children: !user ? 'Authentication Required' : isScanning ? 'Processing...' : 'Ready to Scan'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 259,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-gray-500 mb-4\",\n          children: !user ? 'Please login to use the RFID scanner' : isScanning ? 'Recording attendance...' : 'Place RFID card near reader or scan with R10D device'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 263,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-sm text-gray-400\",\n          children: user && 'üí° Tip: Keep this page focused for automatic RFID detection'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 273,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 7\n    }, this), lastScan && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"card\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"text-lg font-medium text-gray-900 mb-4\",\n        children: \"Last Scan Result\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 282,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center space-x-4 p-4 bg-gray-50 rounded-lg\",\n        children: [getStatusIcon(lastScan.success, lastScan.status), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex-1\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center space-x-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"font-medium text-gray-900\",\n              children: lastScan.user ? lastScan.user.name : 'Unknown User'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 289,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: `px-2 py-1 text-xs font-semibold rounded-full ${getStatusColor(lastScan.success, lastScan.status)}`,\n              children: lastScan.success ? lastScan.status : 'Error'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 292,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 288,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-sm text-gray-500\",\n            children: [\"RFID: \", lastScan.rfid, \" \\u2022 \", lastScan.time, lastScan.user && /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\" \\u2022 ID: \", lastScan.user.student_id]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 302,\n              columnNumber: 19\n            }, this), lastScan.lockTriggered && /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-green-600 font-medium\",\n              children: \" \\u2022 \\uD83D\\uDD13 Lock Opened\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 305,\n              columnNumber: 19\n            }, this), lastScan.lockError && /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-red-600 font-medium\",\n              children: \" \\u2022 \\u26A0\\uFE0F Lock Failed\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 308,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 299,\n            columnNumber: 15\n          }, this), !lastScan.success && lastScan.error && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-sm text-red-600 mt-1\",\n            children: lastScan.error\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 313,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 287,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 281,\n      columnNumber: 9\n    }, this), scanHistory.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"card\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"text-lg font-medium text-gray-900 mb-4\",\n        children: \"Recent Scans\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 325,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"space-y-2\",\n        children: scanHistory.map(scan => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg\",\n          children: [getStatusIcon(scan.success, scan.status), /*#__PURE__*/_jsxDEV(UserIcon, {\n            className: \"h-5 w-5 text-gray-400\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 332,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex-1\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center space-x-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-sm font-medium text-gray-900\",\n                children: scan.user ? scan.user.name : 'Unknown'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 336,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: `px-2 py-1 text-xs font-semibold rounded-full ${getStatusColor(scan.success, scan.status)}`,\n                children: scan.success ? scan.status : 'Error'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 339,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 335,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-xs text-gray-500\",\n              children: [scan.rfid, \" \\u2022 \", scan.time]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 346,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 334,\n            columnNumber: 17\n          }, this)]\n        }, scan.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 327,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 324,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"card\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"text-lg font-medium text-gray-900 mb-4\",\n        children: \"Instructions\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 358,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"space-y-3 text-sm text-gray-600\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-start space-x-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"font-semibold text-blue-600\",\n            children: \"1.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 362,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"Keep this browser tab focused and active\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 363,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 361,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-start space-x-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"font-semibold text-blue-600\",\n            children: \"2.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 367,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"Scan RFID card with your R10D reader\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 368,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 366,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-start space-x-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"font-semibold text-blue-600\",\n            children: \"3.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 372,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"Attendance will be recorded automatically\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 373,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 371,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-start space-x-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"font-semibold text-blue-600\",\n            children: \"4.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 377,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"Check attendance logs page to view all records\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 378,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 376,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 360,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 357,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 221,\n    columnNumber: 5\n  }, this);\n}\n_s(RFIDScanner, \"EC0IyYleoIdlaNWwHLh6YdG4uno=\", false, function () {\n  return [useAuth];\n});\n_c = RFIDScanner;\nexport default RFIDScanner;\nvar _c;\n$RefreshReg$(_c, \"RFIDScanner\");","map":{"version":3,"names":["React","useState","useEffect","useRef","axios","toast","useAuth","CreditCardIcon","CheckCircleIcon","XCircleIcon","ClockIcon","UserIcon","jsxDEV","_jsxDEV","RFIDScanner","_s","user","isScanning","setIsScanning","lastScan","setLastScan","scanHistory","setScanHistory","inputRef","scanTimeoutRef","rfidBufferRef","current","focus","handleFocus","window","addEventListener","document","removeEventListener","clearTimeout","handleKeyPress","e","key","length","processRFIDScan","trim","target","value","setTimeout","rfidData","error","console","log","token","localStorage","getItem","Error","response","post","rfid_data","location","timestamp","Date","toISOString","headers","Authorization","status","attendance","data","scanResult","id","now","rfid","time","toLocaleTimeString","timeZone","success","prev","slice","type","triggerSolenoidLock","name","lockTriggered","lockError","message","_error$response","_error$response$data","_error$response2","getStatusIcon","className","fileName","_jsxFileName","lineNumber","columnNumber","toLowerCase","getStatusColor","userName","action","timeout","_error$response3","_error$response3$data","children","ref","onKeyPress","style","position","left","opacity","pointerEvents","autoFocus","student_id","map","scan","_c","$RefreshReg$"],"sources":["C:/Users/Harley/Desktop/Capstone/attendanceiot/IOTCapstone/frontend/src/pages/RFIDScanner.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport axios from 'axios';\nimport { toast } from 'react-hot-toast';\nimport { useAuth } from '../contexts/AuthContext';\nimport { \n  CreditCardIcon,\n  CheckCircleIcon,\n  XCircleIcon,\n  ClockIcon,\n  UserIcon\n} from '@heroicons/react/24/outline';\n\nfunction RFIDScanner() {\n  const { user } = useAuth();\n  const [isScanning, setIsScanning] = useState(false);\n  const [lastScan, setLastScan] = useState(null);\n  const [scanHistory, setScanHistory] = useState([]);\n  const inputRef = useRef(null);\n  const scanTimeoutRef = useRef(null);\n  const rfidBufferRef = useRef('');\n\n  useEffect(() => {\n    // Focus the hidden input when component mounts\n    if (inputRef.current) {\n      inputRef.current.focus();\n    }\n\n    // Refocus input when window regains focus\n    const handleFocus = () => {\n      if (inputRef.current) {\n        inputRef.current.focus();\n      }\n    };\n\n    window.addEventListener('focus', handleFocus);\n    document.addEventListener('click', handleFocus);\n\n    return () => {\n      window.removeEventListener('focus', handleFocus);\n      document.removeEventListener('click', handleFocus);\n      if (scanTimeoutRef.current) {\n        clearTimeout(scanTimeoutRef.current);\n      }\n    };\n  }, []);\n\n  const handleKeyPress = (e) => {\n    // RFID readers typically send data very quickly and end with Enter\n    if (e.key === 'Enter') {\n      if (rfidBufferRef.current.length > 4) {\n        processRFIDScan(rfidBufferRef.current.trim());\n      }\n      rfidBufferRef.current = '';\n      e.target.value = '';\n      return;\n    }\n\n    // Add character to buffer\n    rfidBufferRef.current += e.key;\n\n    // Clear previous timeout and set new one\n    if (scanTimeoutRef.current) {\n      clearTimeout(scanTimeoutRef.current);\n    }\n\n    // If no more input for 200ms, process the scan\n    scanTimeoutRef.current = setTimeout(() => {\n      if (rfidBufferRef.current.length > 4) {\n        processRFIDScan(rfidBufferRef.current.trim());\n      }\n      rfidBufferRef.current = '';\n      if (inputRef.current) {\n        inputRef.current.value = '';\n      }\n    }, 200);\n  };\n\n  const processRFIDScan = async (rfidData) => {\n    try {\n      // Check if user is authenticated\n      if (!user) {\n        toast.error('‚ùå Please login to use RFID scanner');\n        return;\n      }\n\n      setIsScanning(true);\n      console.log('RFID Card Detected:', rfidData);\n\n      // Get authentication token\n      const token = localStorage.getItem('token');\n      if (!token) {\n        throw new Error('No authentication token found');\n      }\n\n      const response = await axios.post('http://localhost:5000/api/logs/rfid-scan', {\n        rfid_data: rfidData,\n        location: 'inside',\n        timestamp: new Date().toISOString()\n      }, {\n        headers: { Authorization: `Bearer ${token}` }\n      });\n\n      if (response.status === 201) {\n        const attendance = response.data.attendance;\n        const scanResult = {\n          id: Date.now(),\n          rfid: rfidData,\n          user: attendance.user,\n          status: attendance.status,\n          time: new Date().toLocaleTimeString('en-US', { timeZone: 'Asia/Manila' }),\n          success: true\n        };\n\n        setLastScan(scanResult);\n        setScanHistory(prev => [scanResult, ...prev.slice(0, 9)]); // Keep last 10 scans\n        \n        // Check if user is instructor or admin for lock control\n        if (attendance.user.type === 'instructor' || attendance.user.type === 'admin') {\n          console.log('üîì Instructor/Admin detected - Triggering solenoid lock...');\n          \n          // Trigger solenoid lock via ESP32\n          try {\n            await triggerSolenoidLock(attendance.user.name);\n            scanResult.lockTriggered = true;\n            toast.success(`‚úÖ ${attendance.user.name} - ${attendance.status} - üîì Lock Opened!`);\n          } catch (lockError) {\n            console.error('Lock trigger error:', lockError);\n            scanResult.lockTriggered = false;\n            scanResult.lockError = lockError.message;\n            toast.success(`‚úÖ ${attendance.user.name} - ${attendance.status} - ‚ö†Ô∏è Lock control failed`);\n          }\n        } else {\n          toast.success(`‚úÖ ${attendance.user.name} - ${attendance.status}`);\n        }\n      }\n\n    } catch (error) {\n      console.error('RFID scan error:', error);\n      \n      const scanResult = {\n        id: Date.now(),\n        rfid: rfidData,\n        user: null,\n        status: 'Error',\n        time: new Date().toLocaleTimeString('en-US', { timeZone: 'Asia/Manila' }),\n        success: false,\n        error: error.response?.data?.message || 'Unknown error'\n      };\n\n      setLastScan(scanResult);\n      setScanHistory(prev => [scanResult, ...prev.slice(0, 9)]);\n      \n      if (error.response?.status === 404) {\n        toast.error('‚ùå RFID card not registered');\n      } else {\n        toast.error('‚ùå Failed to record attendance');\n      }\n    } finally {\n      setIsScanning(false);\n    }\n  };\n\n  const getStatusIcon = (success, status) => {\n    if (!success) return <XCircleIcon className=\"h-5 w-5 text-red-500\" />;\n    \n    switch (status?.toLowerCase()) {\n      case 'present':\n        return <CheckCircleIcon className=\"h-5 w-5 text-green-500\" />;\n      case 'late':\n        return <ClockIcon className=\"h-5 w-5 text-yellow-500\" />;\n      default:\n        return <CheckCircleIcon className=\"h-5 w-5 text-blue-500\" />;\n    }\n  };\n\n  const getStatusColor = (success, status) => {\n    if (!success) return 'bg-red-100 text-red-800';\n    \n    switch (status?.toLowerCase()) {\n      case 'present':\n        return 'bg-green-100 text-green-800';\n      case 'late':\n        return 'bg-yellow-100 text-yellow-800';\n      default:\n        return 'bg-blue-100 text-blue-800';\n    }\n  };\n\n  // Function to trigger solenoid lock via ESP32\n  const triggerSolenoidLock = async (userName) => {\n    try {\n      // Get authentication token\n      const token = localStorage.getItem('token');\n      if (!token) {\n        throw new Error('No authentication token found');\n      }\n\n      // Send command to ESP32 to open lock\n      const response = await axios.post('http://localhost:5000/api/devices/trigger-lock', {\n        action: 'open',\n        user: userName,\n        timestamp: new Date().toISOString()\n      }, {\n        headers: { Authorization: `Bearer ${token}` },\n        timeout: 15000 // 15 second timeout\n      });\n\n      if (response.status === 200) {\n        console.log('üîì Solenoid lock triggered successfully');\n        return true;\n      } else {\n        throw new Error('Failed to trigger lock');\n      }\n    } catch (error) {\n      console.error('Solenoid lock trigger error:', error);\n      throw new Error('Lock control failed: ' + (error.response?.data?.message || error.message));\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Hidden input for RFID capture */}\n      <input\n        ref={inputRef}\n        type=\"text\"\n        onKeyPress={handleKeyPress}\n        style={{\n          position: 'absolute',\n          left: '-9999px',\n          opacity: 0,\n          pointerEvents: 'none'\n        }}\n        autoFocus\n      />\n\n      {/* Header */}\n      <div>\n        <h1 className=\"text-2xl font-bold text-gray-900\">RFID Scanner</h1>\n        <p className=\"text-gray-600\">Scan RFID cards for attendance tracking</p>\n      </div>\n\n      {/* Scanner Status */}\n      <div className=\"card\">\n        <div className=\"text-center py-8\">\n          {!user ? (\n            <div className=\"mx-auto w-24 h-24 rounded-full flex items-center justify-center mb-4 bg-red-100\">\n              <XCircleIcon className=\"h-12 w-12 text-red-600\" />\n            </div>\n          ) : (\n            <div className={`mx-auto w-24 h-24 rounded-full flex items-center justify-center mb-4 ${\n              isScanning ? 'bg-blue-100 animate-pulse' : 'bg-gray-100'\n            }`}>\n              <CreditCardIcon className={`h-12 w-12 ${\n                isScanning ? 'text-blue-600' : 'text-gray-400'\n              }`} />\n            </div>\n          )}\n          \n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\n            {!user ? 'Authentication Required' : (isScanning ? 'Processing...' : 'Ready to Scan')}\n          </h3>\n          \n          <p className=\"text-gray-500 mb-4\">\n            {!user \n              ? 'Please login to use the RFID scanner'\n              : (isScanning \n                ? 'Recording attendance...' \n                : 'Place RFID card near reader or scan with R10D device'\n              )\n            }\n          </p>\n\n          <div className=\"text-sm text-gray-400\">\n            {user && 'üí° Tip: Keep this page focused for automatic RFID detection'}\n          </div>\n        </div>\n      </div>\n\n      {/* Last Scan Result */}\n      {lastScan && (\n        <div className=\"card\">\n          <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Last Scan Result</h3>\n          \n          <div className=\"flex items-center space-x-4 p-4 bg-gray-50 rounded-lg\">\n            {getStatusIcon(lastScan.success, lastScan.status)}\n            \n            <div className=\"flex-1\">\n              <div className=\"flex items-center space-x-2\">\n                <span className=\"font-medium text-gray-900\">\n                  {lastScan.user ? lastScan.user.name : 'Unknown User'}\n                </span>\n                <span className={`px-2 py-1 text-xs font-semibold rounded-full ${\n                  getStatusColor(lastScan.success, lastScan.status)\n                }`}>\n                  {lastScan.success ? lastScan.status : 'Error'}\n                </span>\n              </div>\n              \n              <div className=\"text-sm text-gray-500\">\n                RFID: {lastScan.rfid} ‚Ä¢ {lastScan.time}\n                {lastScan.user && (\n                  <span> ‚Ä¢ ID: {lastScan.user.student_id}</span>\n                )}\n                {lastScan.lockTriggered && (\n                  <span className=\"text-green-600 font-medium\"> ‚Ä¢ üîì Lock Opened</span>\n                )}\n                {lastScan.lockError && (\n                  <span className=\"text-red-600 font-medium\"> ‚Ä¢ ‚ö†Ô∏è Lock Failed</span>\n                )}\n              </div>\n              \n              {!lastScan.success && lastScan.error && (\n                <div className=\"text-sm text-red-600 mt-1\">\n                  {lastScan.error}\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Scan History */}\n      {scanHistory.length > 0 && (\n        <div className=\"card\">\n          <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Recent Scans</h3>\n          \n          <div className=\"space-y-2\">\n            {scanHistory.map((scan) => (\n              <div key={scan.id} className=\"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg\">\n                {getStatusIcon(scan.success, scan.status)}\n                \n                <UserIcon className=\"h-5 w-5 text-gray-400\" />\n                \n                <div className=\"flex-1\">\n                  <div className=\"flex items-center space-x-2\">\n                    <span className=\"text-sm font-medium text-gray-900\">\n                      {scan.user ? scan.user.name : 'Unknown'}\n                    </span>\n                    <span className={`px-2 py-1 text-xs font-semibold rounded-full ${\n                      getStatusColor(scan.success, scan.status)\n                    }`}>\n                      {scan.success ? scan.status : 'Error'}\n                    </span>\n                  </div>\n                  \n                  <div className=\"text-xs text-gray-500\">\n                    {scan.rfid} ‚Ä¢ {scan.time}\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Instructions */}\n      <div className=\"card\">\n        <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Instructions</h3>\n        \n        <div className=\"space-y-3 text-sm text-gray-600\">\n          <div className=\"flex items-start space-x-2\">\n            <span className=\"font-semibold text-blue-600\">1.</span>\n            <span>Keep this browser tab focused and active</span>\n          </div>\n          \n          <div className=\"flex items-start space-x-2\">\n            <span className=\"font-semibold text-blue-600\">2.</span>\n            <span>Scan RFID card with your R10D reader</span>\n          </div>\n          \n          <div className=\"flex items-start space-x-2\">\n            <span className=\"font-semibold text-blue-600\">3.</span>\n            <span>Attendance will be recorded automatically</span>\n          </div>\n          \n          <div className=\"flex items-start space-x-2\">\n            <span className=\"font-semibold text-blue-600\">4.</span>\n            <span>Check attendance logs page to view all records</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default RFIDScanner;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}